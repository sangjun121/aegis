# Aegis — 도메인 검증 및 의존성 관리 프레임워크

Aegis는 도메인 객체가 생성되는 시점부터 유효함을 보장하고, 모듈 간 상태 일관성을 유지하기 위한 도메인 검증 프레임워크입니다.

# 📖 개요 (Overview)

Aegis는 도메인 객체의 내부 불변식(Invariant) 뿐만 아니라
도메인 간 상태 의존 관계(Cross-Module Dependency) 를 함께 검증하는
경량 도메인 검증 프레임워크입니다.

- 객체 생성 시 자동 검증 수행
- 도메인 간 검증 의존 관계 선언 및 강제
- 검증 의존 관계 시각화 제공

**도메인 내부 검증**과 **외부 도메인에 의존된 상태 검증**을 지원합니다.

# 주요 기능 (Key Features)

## 1️⃣ 도메인 스캔 및 등록
- 애플리케이션 실행 시 Config 파일을 기준으로 검증 대상 도메인 클래스를 자동 탐색합니다.
- 두 가지 탐색 방식을 지원합니다.
  - 경로 기반 탐색: 공통 패키지 경로를 지정하여 자동 스캔
  - 명시적 선언: `domains: [Account, Club, Member]`
- 스캔된 도메인 클래스는 프레임워크의 관리 대상으로 등록됩니다.
- 각 도메인은 다음 조건을 충족해야 합니다.
  - @DomainValidated 애노테이션 선언
  - 대응되는 Validator 클래스 존재
  - 검증이 의존되는 상대 도메인 선언
- 누락 시 부트스트랩 단계에서 예외가 발생합니다. (MissingValidatorException)

## 2️⃣ Validator 구현 강제
- 각 도메인 클래스는 반드시 DomainValidator 인터페이스를 구현해야 합니다.
- 도메인과 관련된 모든 검증 로직은 Validator 내부에 캡슐화됩니다.
- 각 도메인에 위치한 모든 멤버 변수에 대한 검증 메소드를 작성해야 합니다.
- Aegis는 애플리케이션 시작 시 모든 도메인의 Validator 구현 여부를 검사합니다.
- Validator 미구현 시 부트 단계에서 예외가 발생합니다.
- 검증이 필요 없는 필드는 @NoValidationRequired로 명시합니다.

## 3️⃣ 자동 검증 실행 보장
- @DomainValidated 가 선언된 클래스는 생성자 종료 시점에 Validator의 `validate()` 메소드가 자동 실행됩니다.
- 개발자가 검증 메서드를 직접 호출할 필요가 없습니다.
- 즉, 객체 생성 시점의 유효 상태 보장의 불변식이 준수됩니다.

## 4️⃣ 의존 도메인 선언 검사
- 외부 도메인의 상태에 의존하는 검증이 필요한 경우, 해당 도메인에서 의존 관계를 명시적으로 선언합니다. (여기서 의존관계는 실의존관계가 아닌 **검증 의존 관계**를 의미합니다.)

`예시:
@Required(domain = “Member”)
public class Club { … }`

- 부트스트랩 단계에서 다음을 검사합니다.
  - 선언된 선행 도메인(Member)이 존재하는지
  - 검증 로직(DependencyValidator<A,B>)이 구현되어 있는지(해당 부분에 대한 구현 메소드는 해당 도메인 내부로 통합할 예정)
  - 누락 시 _MissingDependencyValidatorException_ 발생

## 5️⃣ 의존 도메인 상태 검증
- 런타임 중 도메인 인스턴스 생성 시, 의존 도메인의 실제 상태가 유효한지를 검증합니다.

## 6️⃣ 부가기능 1 — 공통 검증 어노테이션
- 일반적인 검증(Null, Blank, Range 등)은 도메인 필드가 아닌 Validator 클래스의 메서드에 선언할 수 있습니다.
- 기본 제공 어노테이션(@NotBlank, @Range, @Email) 외에도 사용자 정의 커스텀 어노테이션을 추가할 수 있습니다.

## 7️⃣ 부가기능 2 — 검증 실패 처리 (예외 및 로그)
**예외 발생시 처리 시퀀스**
- 두 가지 검증 책임을 구분하여 관리합니다.

  1. 도메인 내부 검증: DomainValidationException
  2. 의존 관계 검증: DependentDomainValidationException
- 모든 예외는 공통 포맷으로 처리됩니다.

**로그 처리**
- 모든 검증 실패는 공통 포맷으로 기록됩니다.
  - `[ValidationError] domain=Club validator=ClubValidator code=MEMBER_INACTIVE message=“비활성화된 회원입니다.” path=Club.member`
- ValidationExceptionHandler 가 모든 검증 예외를 중앙에서 처리합니다.

## 8️⃣ 부가기능 3 — 검증 의존 관계 시각화
- 도메인 간 검증 관계를 그래프 형태로 시각화합니다.
  - 노드(Node): 도메인 클래스
  - 엣지(Edge): 검증 의존 관계 
- 순환 의존 및 누락된 검증 관계를 탐지 가능합니다.

## 라이프 사이클에서의 프레임워크 역할

| 단계      | 설명                                   | 주요 검증 내용                                                     |
|---------|--------------------------------------|--------------------------------------------------------------|
| 부트스트랩 단계 | 앱 시작 시 도메인/Validator 등록 및 누락 검사      | Validator 존재, 의존 선언 누락, DependencyValidator 존재 여부            |
| 런타임 단계  | 실제 검증 실행                             | 도메인 내부 규칙 + 의존 상태 검증                                         |
| 개발/빌드 단계 | 시각화 및 구조 분석                          | 검증 관계 그래프 생성, 순환 탐지                                          |

## 기대효과
1.	도메인 Validator 내부에 모든 검증 책임을 캡슐화할 수 있습니다.
2.	도메인 간 상태 의존 관계를 명시적으로 표현하고 실행 시 자동 검증이 가능합니다.
3.	구조적 의존 관계를 시각화하여 설계 의도를 유지합니다.
4.	부트 단계에서 검증 누락을 사전에 탐지할 수 있습니다.
